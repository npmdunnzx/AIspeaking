<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Luy·ªán n√≥i ti·∫øng Anh v·ªõi GPT</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <img
        src="https://images.unsplash.com/photo-1520454974749-611b7248ffdb"
        alt="Logo"
        class="logo"  
      />
      <h1>üó£Ô∏è App ƒë·∫≥ng c·∫•p nh·∫•t th·∫ø gi·ªõi</h1>
    </header>

    <main>
      <div class="chat-box" id="history">
        <!-- L·ªãch s·ª≠ tin nh·∫Øn s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
      </div>

      <div class="input-area">
        <input type="text" id="userInput" placeholder="Nh·∫≠p c√¢u ti·∫øng Anh..." />
        <button onclick="sendText()">G·ª≠i</button>
        <button onclick="startListening()">üé§</button>
      </div>
    </main>
    <a href="https://www.facebook.com/dungkksmtp" target="_self">My contact</a
    ><br />
    <script>
      async function sendText() {
        const inputElem = document.getElementById("userInput");
        const input = inputElem.value.trim();
        if (!input) return;

        inputElem.value = "";
        addMessage("üßë B·∫°n", input);

        addMessage("ü§ñ GPT", "‚è≥ ƒêang x·ª≠ l√Ω...");

        const res = await fetch("http://localhost:5000/api/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt: input }),
        });

        const data = await res.json();
        const reply = data.reply;

        updateLastMessage("ü§ñ GPT", reply);

        // ‚úÖ Ph√°t √¢m thanh b·∫±ng tr√¨nh duy·ªát
        const utterance = new SpeechSynthesisUtterance(reply);
        utterance.lang = "en-US";
        window.speechSynthesis.speak(utterance);
      }

      function addMessage(sender, text) {
        const history = document.getElementById("history");
        const message = document.createElement("div");
        message.className = "message";
        message.innerHTML = `<span class="sender">${sender}:</span><div class="bubble">${text}</div>`;
        history.appendChild(message);
        history.scrollTop = history.scrollHeight;
      }

      function updateLastMessage(sender, newText) {
        const history = document.getElementById("history");
        const messages = history.querySelectorAll(".message");
        const lastMsg = messages[messages.length - 1];
        if (
          lastMsg &&
          lastMsg.querySelector(".sender").textContent === `${sender}:`
        ) {
          lastMsg.querySelector(".bubble").textContent = newText;
        }
      }

      function startListening() {
        const recognition = new (window.SpeechRecognition ||
          window.webkitSpeechRecognition)();
        recognition.lang = "en-US";
        recognition.start();

        recognition.onresult = function (event) {
          const text = event.results[0][0].transcript;
          document.getElementById("userInput").value = text;
          sendText();
        };

        recognition.onerror = function () {
          alert("‚ö†Ô∏è Kh√¥ng th·ªÉ nh·∫≠n gi·ªçng n√≥i.");
        };
      }
    </script>
  </body>
</html>
